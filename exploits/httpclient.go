package exploits

import (
	"crypto/tls"
	"net/http"
	"net/url"
	"strings"
	"time"
)

// NewClient 创建一个支持可选代理的 HTTP 客户端
func NewClient(proxy *url.URL, timeout time.Duration) *http.Client {
	tr := &http.Transport{TLSClientConfig: &tls.Config{InsecureSkipVerify: true}}
	if proxy != nil {
		tr.Proxy = http.ProxyURL(proxy)
	}
	return &http.Client{Transport: tr, Timeout: timeout}
}

// NormalizeBaseURL 规范化基础 URL，只保留协议和域名部分
// 例如：http://localhost:8080/geoserver/web/123 → http://localhost:8080
func NormalizeBaseURL(rawURL string) string {
	if !strings.HasPrefix(rawURL, "http://") && !strings.HasPrefix(rawURL, "https://") {
		rawURL = "http://" + rawURL
	}

	parsedURL, err := url.Parse(rawURL)
	if err != nil {
		return rawURL
	}

	// 只保留协议和主机部分
	baseURL := parsedURL.Scheme + "://" + parsedURL.Host
	return baseURL
}
